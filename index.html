<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Application</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>All Quizzes</h1>
    <div id="quiz-list"></div>
    <div id="quiz-container" style="display: none;">
      <h2 id="quiz-title"></h2>
      <form id="quiz-form"></form>
      <button id="submit-btn" style="display: none;">Submit</button>
    </div>
  </div>

  <script >
    // Fetch all quizzes and display them
const quizListContainer = document.getElementById('quiz-list');
const quizContainer = document.getElementById('quiz-container');
const quizForm = document.getElementById('quiz-form');
const submitButton = document.getElementById('submit-btn');
const quizTitle = document.getElementById('quiz-title');

// Fetch quizzes when the page loads
window.onload = async function () {
  try {
    const response = await fetch('/api/quizzes');
    const data = await response.json();
    displayQuizList(data.quizzes);
  } catch (error) {
    console.error('Error fetching quizzes:', error);
  }
};

// Function to display all quiz titles
function displayQuizList(quizzes) {
  quizListContainer.innerHTML = '';
  quizzes.forEach(quiz => {
    const quizElement = document.createElement('div');
    quizElement.innerText = quiz.title;
    quizElement.classList.add('quiz-title');
    quizElement.onclick = () => loadQuiz(quiz._id);  // Load quiz on click
    quizListContainer.appendChild(quizElement);
  });
}

// Function to load a quiz by ID and display the questions
async function loadQuiz(quizId) {
  try {
    const response = await fetch(`/api/quizzes/${quizId}`);
    const quiz = await response.json();
    displayQuiz(quiz);
  } catch (error) {
    console.error('Error loading quiz:', error);
  }
}

// Function to display questions and answer choices for a selected quiz
function displayQuiz(quiz) {
  // Hide the list of quizzes and show the quiz form
  quizListContainer.style.display = 'none';
  quizContainer.style.display = 'block';

  // Set the quiz title
  quizTitle.innerText = quiz.title;

  // Clear the quiz form
  quizForm.innerHTML = '';
  
  // Loop through the questions and display them
  quiz.questions.forEach((question, index) => {
    const questionDiv = document.createElement('div');
    questionDiv.classList.add('question');
    
    const questionText = document.createElement('p');
    questionText.innerText = question.questionText;
    questionDiv.appendChild(questionText);
    
    question.answerChoices.forEach((choice, i) => {
      const choiceLabel = document.createElement('label');
      const choiceInput = document.createElement('input');
      choiceInput.type = 'radio';
      choiceInput.name = `question-${index}`;
      choiceInput.value = choice.optionText;
      choiceLabel.appendChild(choiceInput);
      choiceLabel.appendChild(document.createTextNode(choice.optionText));
      questionDiv.appendChild(choiceLabel);
      questionDiv.appendChild(document.createElement('br'));
    });

    quizForm.appendChild(questionDiv);
  });

  // Show submit button
  submitButton.style.display = 'block';
}

// Submit quiz answers
submitButton.onclick = function () {
  const formData = new FormData(quizForm);
  const answers = [];

  formData.forEach((value, key) => {
    answers.push(value);
  });

  // Send answers to the server to calculate the score
  const quizId = quizForm.dataset.quizId;
  submitQuiz(quizId, answers);
};

// Function to submit the quiz answers to the server
async function submitQuiz(quizId, answers) {
  try {
    const response = await fetch('/api/quizzes/submit', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ quizId, answers, name: 'User' }),  // Example name
    });
    const result = await response.json();
    alert(`Your score is: ${result.score}`);
  } catch (error) {
    console.error('Error submitting quiz:', error);
  }
}

  </script>
</body>
</html>
